
{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}{% trans "User Analytics" %} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .analytics-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    .metric-card {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px;
        margin-bottom: 15px;
    }
    .metric-number {
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: 10px;
    }
    .metric-label {
        font-size: 1.1em;
        opacity: 0.9;
    }
    .chart-container {
        position: relative;
        height: 400px;
        margin: 20px 0;
    }
</style>
{% endblock %}

{% block content %}
<h1>{% trans "User Analytics" %}</h1>

<div class="row">
    <div class="col-md-4">
        <div class="metric-card">
            <div class="metric-number">{{ conversion_rate }}%</div>
            <div class="metric-label">{% trans "Trial to Premium Conversion Rate" %}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="metric-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="metric-number">{{ active_users_week }}</div>
            <div class="metric-label">{% trans "Active Users (7 days)" %}</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="metric-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
            <div class="metric-number">{{ daily_registrations|length }}</div>
            <div class="metric-label">{% trans "Days Tracked" %}</div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="analytics-card">
            <h3>{% trans "User Registrations (Last 30 Days)" %}</h3>
            <div class="chart-container">
                <canvas id="registrationChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
// User Registration Chart
const regCtx = document.getElementById('registrationChart').getContext('2d');
const registrationData = {{ daily_registrations|safe }};

new Chart(regCtx, {
    type: 'line',
    data: {
        labels: registrationData.map(item => item.date),
        datasets: [{
            label: '{% trans "New Registrations" %}',
            data: registrationData.map(item => item.count),
            borderColor: '#36A2EB',
            backgroundColor: 'rgba(54, 162, 235, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        },
        plugins: {
            legend: {
                position: 'top'
            }
        }
    }
});
</script>
{% endblock %}
