{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Upgrade to Premium" %} - Savoir+ LMS{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Header -->
            <div class="card mb-4 shadow">
                <div class="card-header bg-warning text-dark text-center">
                    <h2 class="mb-0">
                        <i class="fas fa-crown me-2"></i>{% trans "Upgrade to Premium" %}
                    </h2>
                    <p class="mb-0">{% trans "Unlock the full learning experience" %}</p>
                </div>
            </div>

            <!-- Trial Status -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h5>{% trans "Your Trial Status" %}</h5>
                            {% if user.is_trial_active %}
                                <p class="text-success mb-0">
                                    <i class="fas fa-clock me-2"></i>
                                    {% trans "Trial active until" %} {{ user.trial_end_date|date:"F d, Y" }}
                                </p>
                            {% else %}
                                <p class="text-danger mb-0">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    {% trans "Trial expired on" %} {{ user.trial_end_date|date:"F d, Y" }}
                                </p>
                            {% endif %}
                        </div>
                        <div class="col-auto">
                            <span class="badge bg-warning text-dark fs-6">{% trans "Trial User" %}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Comparison -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-comparison me-2"></i>{% trans "What's Included" %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Trial Column -->
                        <div class="col-md-6">
                            <h6 class="text-warning">
                                <i class="fas fa-user me-2"></i>{% trans "Trial Account" %}
                            </h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Access to all video content" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Read all lesson materials" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Browse roadmaps and courses" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-times text-danger me-2"></i>
                                    {% trans "Quiz access (locked)" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-times text-danger me-2"></i>
                                    {% trans "Final exams (locked)" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-times text-danger me-2"></i>
                                    {% trans "Certificate generation (locked)" %}
                                </li>
                            </ul>
                        </div>
                        
                        <!-- Premium Column -->
                        <div class="col-md-6">
                            <h6 class="text-success">
                                <i class="fas fa-crown me-2"></i>{% trans "Premium Account" %}
                            </h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Access to all video content" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Read all lesson materials" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Browse roadmaps and courses" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Full quiz access" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Take final exams" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Download certificates" %}
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-check text-success me-2"></i>
                                    {% trans "Priority support" %}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pricing -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white text-center">
                    <h5 class="mb-0">
                        <i class="fas fa-tag me-2"></i>{% trans "Premium Pricing" %}
                    </h5>
                </div>
                <div class="card-body text-center">
                    <div class="pricing-box">
                        <h2 class="text-success">15,000 XOF</h2>
                        <p class="text-muted">{% trans "One-time payment for lifetime access" %}</p>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            {% trans "This is a mock payment integration. In production, this would connect to Flutterwave or MTN MoMo." %}
                        </div>
                        
                        <!-- Mock Payment Form -->
                        <form id="mockPaymentForm" class="mt-3">
                            <div class="mb-3">
                                <label for="phoneNumber" class="form-label">{% trans "Phone Number" %}</label>
                                <input type="tel" class="form-control" id="phoneNumber" placeholder="+228 XX XX XX XX" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="paymentMethod" class="form-label">{% trans "Payment Method" %}</label>
                                <select class="form-select" id="paymentMethod" required>
                                    <option value="">{% trans "Select payment method" %}</option>
                                    <option value="mtn_momo">{% trans "MTN Mobile Money" %}</option>
                                    <option value="moov_money">{% trans "Moov Money" %}</option>
                                    <option value="flutterwave">{% trans "Flutterwave" %}</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-credit-card me-2"></i>
                                {% trans "Proceed to Payment" %}
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- FAQ -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-question-circle me-2"></i>{% trans "Frequently Asked Questions" %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="faq1">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1">
                                    {% trans "What happens after I upgrade?" %}
                                </button>
                            </h2>
                            <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {% trans "Once your payment is processed, your account will be immediately upgraded to premium status. You'll have access to all quizzes, final exams, and certificate generation features." %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="faq2">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse2">
                                    {% trans "Is this a one-time payment?" %}
                                </button>
                            </h2>
                            <div id="faqCollapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {% trans "Yes, this is a one-time payment that gives you lifetime access to all premium features on Savoir+." %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="faq3">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse3">
                                    {% trans "What payment methods are supported?" %}
                                </button>
                            </h2>
                            <div id="faqCollapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    {% trans "We support MTN Mobile Money, Moov Money, and other payment methods through Flutterwave, making it easy to pay from anywhere in Togo and neighboring countries." %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('mockPaymentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const phoneNumber = document.getElementById('phoneNumber').value;
    const paymentMethod = document.getElementById('paymentMethod').value;
    
    if (!phoneNumber || !paymentMethod) {
        alert('{% trans "Please fill in all fields." %}');
        return;
    }
    
    // Mock payment processing
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>{% trans "Processing..." %}';
    
    // Simulate payment processing delay
    setTimeout(() => {
        // Mock successful payment
        const mockTransactionId = 'MOCK_' + Date.now();
        
        // Simulate payment callback
        fetch('{% url "payment_callback" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: new URLSearchParams({
                'transaction_id': mockTransactionId,
                'status': 'successful',
                'user_id': '{{ user.id }}'
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('{% trans "Payment successful! Your account has been upgraded to premium." %}');
                window.location.href = '{% url "dashboard" %}';
            } else {
                alert('{% trans "Payment failed. Please try again." %}');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('{% trans "An error occurred. Please try again." %}');
        })
        .finally(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        });
    }, 2000);
});
</script>
{% endblock %}
